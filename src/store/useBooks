import { useQuery } from 'react-query';
import { searchBooks, getBooksBySubject } from '../api/api';
import useBookStore from '../store/useBookStore';

// 책 검색을 위한 커스텀 훅
export const useSearchBooks = (query, page = 1) => {
  return useQuery(
    ['searchBooks', query, page],
    () => searchBooks(query, page),
    {
      enabled: !!query, // 쿼리가 있을 때만 API 요청
      keepPreviousData: true,
      staleTime: 5 * 60 * 1000, // 5분 캐시
    }
  );
};

// 주제별 책 가져오기 위한 커스텀 훅
export const useBooksBySubject = (subject = 'fiction', limit = 12) => {
  return useQuery(
    ['booksBySubject', subject, limit],
    () => getBooksBySubject(subject, limit),
    {
      staleTime: 10 * 60 * 1000, // 10분 캐시
    }
  );
};

// 메인 페이지에서 기본적으로 보여줄 책들을 위한 훅
export const useMainPageBooks = () => {
  const { searchQuery } = useBookStore();
  
  // 검색어가 있으면 검색 결과를, 없으면 추천 책들을 보여줌
  const searchResult = useSearchBooks(searchQuery);
  const recommendedBooks = useBooksBySubject('fiction');
  
  if (searchQuery) {
    return {
      ...searchResult,
      books: searchResult.data?.docs || [],
      isSearchResult: true,
    };
  }
  
  return {
    ...recommendedBooks,
    books: recommendedBooks.data?.works || [],
    isSearchResult: false,
  };
};